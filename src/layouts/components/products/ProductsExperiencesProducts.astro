---
import config from "@config/config.json";
import { getRelativeLocaleUrl } from "astro:i18n";
import { plainify } from "@lib/utils/textConverter";
const { summary_length } = config.settings;
import categoriesES from "@data/es/categories.json";
import categoriesEN from "@data/en/categories.json";

const { currentLocale } = Astro;
const fallbackLocale = "es";

// Selecciona productos seg√∫n el idioma
const categories_data = currentLocale === "en" ? categoriesES : categoriesEN;
---

<style>
  /* üëá Hover con borde y sombra sin alterar layout */
  .card {
    position: relative;
    transition: all 0.3s ease;
  }

  .card::after {
    content: "";
    position: absolute;
    inset: 0;
    border: 3px solid transparent;
    border-radius: 1.5rem; /* rounded-3xl */
    pointer-events: none;
    transition: all 0.3s ease;
  }

  .card:hover::after {
    border-color: var(--color-secondary);
    box-shadow: 0 0 25px rgba(0, 0, 0, 0.15);
  }

  /* üëá Menos de 400px: apilados uno debajo de otro */
  @media (max-width: 400px) {
    .custom-grid {
      grid-template-columns: 1fr !important;
    }
  }

  /* üëá Desde 401px hasta 767px: 2 columnas, tercer bloque centrado */
  @media (min-width: 401px) and (max-width: 767px) {
    .custom-grid {
      grid-template-columns: repeat(2, 1fr) !important;
    }
    .custom-grid > :nth-child(3) {
      grid-column: span 2;
      justify-self: center;
      width: 60%;
    }
  }
</style>

<div class="max-w-7xl mx-auto px-3 sm:px-5 md:px-8 xl:px-6">
  <div
    class="custom-grid grid grid-cols-1 md:grid-cols-3
           rounded-3xl overflow-hidden
           my-6 md:my-10 sm:bg-default md:bg-offset lx:bg-default"
  >
    {categories_data?.slice(0, 3).map((data) => (
      <div
        class="card group relative 
               min-h-[190px] sm:min-h-[220px] md:min-h-[240px] lg:min-h-[260px]
               flex flex-col justify-between h-full
               py-8 px-6 sm:py-10 sm:px-8
               bg-offset transition duration-300"
      >
        <img
          src={data.image_url}
          class="w-12 sm:w-14 md:w-16 mx-auto sm:mx-0"
          width="512"
          height="512"
          alt={data.name}
        />
        <div class="space-y-3 mt-6">
          <h5
            class="text-lg sm:text-xl font-semibold transition group-hover:text-primary"
          >
            {data.name}
          </h5>
          <p
            class="block font-sans text-sm sm:text-base leading-snug opacity-75 overflow-hidden group-hover:text-primary"
          >
            {plainify(data.short_description?.slice(0, Number(summary_length)))}
            {data.short_description?.length > summary_length ? "..." : ""}
          </p>
        </div>
        <a
          href={getRelativeLocaleUrl(currentLocale ?? "", `${data.url}`)}
          class="flex items-center justify-between text-sm sm:text-base group-hover:text-primary mt-6"
        >
          <span>Read more</span>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            fill="currentColor"
            class="w-5 h-5 sm:w-6 sm:h-6 -translate-x-4 opacity-0 transition duration-300 group-hover:translate-x-0 group-hover:opacity-100"
          >
            <path
              fill-rule="evenodd"
              d="M12.97 3.97a.75.75 0 011.06 0l7.5 7.5a.75.75 0 010 1.06l-7.5 7.5a.75.75 0 11-1.06-1.06l6.22-6.22H3a.75.75 0 010-1.5h16.19l-6.22-6.22a.75.75 0 010-1.06z"
              clip-rule="evenodd"
            />
          </svg>
        </a>
      </div>
    ))}
  </div>
</div>
